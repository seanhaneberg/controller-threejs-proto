!function(e){function t(t){for(var n,s,c=t[0],a=t[1],u=t[2],v=0,l=[];v<c.length;v++)s=c[v],r[s]&&l.push(r[s][0]),r[s]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(h&&h(t);l.length;)l.shift()();return o.push.apply(o,u||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],n=!0,c=1;c<i.length;c++){var a=i[c];0!==r[a]&&(n=!1)}n&&(o.splice(t--,1),e=s(s.s=i[0]))}return e}var n={},r={0:0},o=[];function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=n,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var c=window.webpackJsonp=window.webpackJsonp||[],a=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var h=a;o.push([2,1]),i()}([,function(e,t,i){},function(e,t,i){"use strict";i.r(t);var n=i(0);i(1);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var o=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};r(o,"boardWidth",10),r(o,"boardHeight",20),r(o,"initX",4),r(o,"initY",0),r(o,"pieces",[[[1,1],[1,0],[1,2],[1,3]],[[1,1],[1,0],[1,2],[2,2]],[[1,0],[0,0],[0,1],[0,2]],[[1,0],[0,0],[1,1],[2,1]],[[0,1],[0,0],[1,1],[1,2]],[[0,1],[0,0],[1,0],[1,1]],[[1,1],[1,0],[1,2],[0,1]]]);var s=o;function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}var h=function(){function e(){c(this,e),this.minX=0,this.minY=0,this.maxX=this.minX+s.boardWidth-1,this.maxY=this.minY+s.boardHeight-1,this.activePiece=null,this.blocks=[],this.listeners=[],this.gameOver=!1}return u(e,[{key:"addTetrisListener",value:function(e){this.listeners.push(e)}},{key:"emitTetrisEvent",value:function(e,t){for(var i=0;i<this.listeners.length;i++)this.listeners[i](e,t)}},{key:"createRandomPiece",value:function(){for(var e=s.pieces,t=Math.floor(Math.random()*e.length),i=s.initX,n=s.initY,r=[],o=e[t],c=0;c<o.length;c++){var a=o[c][0]+i,u=o[c][1]+n;r.push(new v(a,u))}return new l(r)}},{key:"check",value:function(e,t){var i=!0;if(e<this.minX||e>this.maxX||t<this.minY||t>this.maxY)i=!1;else for(var n=0;n<this.blocks.length;n++){var r=this.blocks[n].getPos();if(r.x===e&&r.y===t){i=!1;break}}return i}},{key:"checkRotate",value:function(e,t){if(!e)return!1;var i=e.copy().rotate(t);return this.checkPieceDesc(i)}},{key:"requestActivePieceMove",value:function(e,t){var i=this.activePiece;return this.emitTetrisEvent("request move ("+e+", "+t+")"),this.checkMove(i,e,t)&&i.move(e,t)}},{key:"requestActivePieceRotate",value:function(e){var t=this.activePiece,i=e?"CounterClockwise":"Clockwise";return this.emitTetrisEvent("request"+i+"Rotation",t),this.checkRotate(t,e)&&t.rotate(e)}},{key:"checkMove",value:function(e,t,i){if(!e)return!1;var n=e.copy().move(t,i);return this.checkPieceDesc(n)}},{key:"checkPieceDesc",value:function(e){if(!e)return!1;for(var t=!0,i=0;i<e.blocks.length;i++){var n=e.blocks[i].getPos();if(!this.check(n.x,n.y)){t=!1;break}}return t}},{key:"findFormedLines",value:function(){var e=[];e.fill(0,0,this.boardHeight);for(var t=[],i=0;i<this.blocks.length;i++){var n=this.blocks[i].getPos();e[n.y]++,e[n.y]>=this.boardWidth&&t.push(n.y)}return t}},{key:"addBlocksToBoard",value:function(e){if(!this.checkMove(e,0,0))return!1;for(var t=0;t<e.blocks.length;t++)this.blocks.push(e.blocks[t]);return!0}},{key:"stepFor",value:function(e){for(var t=!0,i=0;i<e&&(t=this.step());i++);return t}},{key:"step",value:function(){var e=!0,t=this.findFormedLines();return t&&t.length>0&&this.emitTetrisEvent("linesFormed",t),this.activePiece?this.checkPieceDesc(this.activePiece.copy().move(0,1))?(this.activePiece.move(0,1),this.emitTetrisEvent("pieceMoved",this.activePiece)):this.addBlocksToBoard(this.activePiece)?(this.emitTetrisEvent("piecePlaced",this.activePiece),this.activePiece=null):(e=!1,this.emitTetrisEvent("gameEndTriggered",this.activePiece)):(this.activePiece=this.createRandomPiece(),this.emitTetrisEvent("activePieceReplaced",this.activePiece)),e}}]),e}(),v=function(){function e(t,i){c(this,e),this.setPos(t,i)}return u(e,[{key:"getPos",value:function(){return this.pos}},{key:"setPos",value:function(e,t){this.pos={x:e,y:t}}},{key:"move",value:function(e,t){return this.setPos(this.pos.x+e,this.pos.y+t)}}]),e}(),l=function(){function e(t){c(this,e),this.blocks=[];for(var i=0;i<t.length;i++)this.blocks.push(new v(t[i].pos.x,t[i].pos.y))}return u(e,[{key:"copy",value:function(){return new e(this.blocks)}},{key:"move",value:function(e,t){for(var i=0;i<this.blocks.length;i++)this.blocks[i].move(e,t);return this}},{key:"rotate",value:function(e){for(var t=this.blocks[0].getPos(),i=0;i<this.blocks.length;i++){var n=this.blocks[i],r=n.getPos(),o=r.x-t.x,s=r.y-t.y,c=t.x+(e?s:-s),a=t.y+(e?-o:o);n.setPos({x:c,y:a})}}}]),e}(),f=h,p=new n.g;p.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(p.domElement);var d=new n.d(45,window.innerWidth/window.innerHeight,1,500);d.position.set(0,0,100),d.lookAt(0,0,0);var k=new n.e,y=4*s.boardWidth,b=4*s.boardHeight,w=-y/2,m=y/2,g=b/2,P=-b/2,x=new f;x.addTetrisListener(function(e,t){switch(console.log(e),console.log(t),e){case"activePieceReplaced":!function(e){e.blocks.forEach(function(t){var i=Math.floor(Math.random()*M.length),r=new n.c({color:M[i]}),o=new n.b(E(t),r);k.add(o),T.push({renderBlock:o,piece:e,block:t})})}(t);break;case"pieceMoved":!function(e){T.forEach(function(t){if(t.piece===e){var i=t.renderBlock.geometry;e.blocks.forEach(function(e){if(t.block===e){var n=e.pos,r=w+4*n.x,o=r+4,s=g-4*n.y,c=s-4;i.vertices[0].x=r,i.vertices[0].y=s,i.vertices[1].x=o,i.vertices[1].y=s,i.vertices[2].x=o,i.vertices[2].y=c,i.vertices[3].x=r,i.vertices[3].y=c,i.vertices[4].x=r,i.vertices[4].y=s}}),i.verticesNeedUpdate=!0}})}(t)}});var T=[],E=function(e,t){var i=e.getPos(),r=new n.a,o=w+4*i.x,s=g-4*i.y,c=o+4,a=s-4;return r.vertices.push(new n.f(o,s,0)),r.vertices.push(new n.f(c,s,0)),r.vertices.push(new n.f(c,a,0)),r.vertices.push(new n.f(o,a,0)),r.vertices.push(new n.f(o,s,0)),r},M=[255,65280];setTimeout(function e(){x.step()&&setTimeout(e,250)},1e3),function e(){requestAnimationFrame(e),p.render(k,d)}();var O,j=new n.c({color:16777215}),R=new n.b(((O=new n.a).vertices.push(new n.f(w,g,0)),O.vertices.push(new n.f(m,g,0)),O.vertices.push(new n.f(m,P,0)),O.vertices.push(new n.f(w,P,0)),O.vertices.push(new n.f(w,g,0)),O),j);k.add(R);var X,Y,B,C,H,S=new n.c({color:16711680}),W=new n.b((X=new n.a,Y=w-1,B=m+1,C=P-1,H=g+1,X.vertices.push(new n.f(Y,C,0)),X.vertices.push(new n.f(B,C,0)),X.vertices.push(new n.f(B,H,0)),X.vertices.push(new n.f(Y,H,0)),X.vertices.push(new n.f(Y,C,0)),X),S);k.add(W),p.render(k,d)}]);
//# sourceMappingURL=main.js.map